<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>example · SubspacePreservingSparsification.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SubspacePreservingSparsification.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>example</a><ul class="internal"><li><a class="tocitem" href="#second-layer"><span>second layer</span></a></li><li><a class="tocitem" href="#second-layer-2"><span>second layer</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>example</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="example"><a class="docs-heading-anchor" href="#example">example</a><a id="example-1"></a><a class="docs-heading-anchor-permalink" href="#example" title="Permalink"></a></h1><p>Lets try to find a sparse representation for a matrix, so that the Frobeniusnorm of the difference is as small as possible. Lets consider a symmetric matrix <span>$M$</span>:</p><pre><code class="language-julia hljs">using SubspacePreservingSparsification
using SparseArrays
using LinearAlgebra
M = [17.05 16.98 0.3 6.99 7; 16.98 0.2 7.1 6.9 0; 0.3 7.1 -12 0.01 17; 6.99 6.9 0.01 -11.97 0; 7 0 17 0 -0.1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 Matrix{Float64}:
 17.05  16.98    0.3     6.99   7.0
 16.98   0.2     7.1     6.9    0.0
  0.3    7.1   -12.0     0.01  17.0
  6.99   6.9     0.01  -11.97   0.0
  7.0    0.0    17.0     0.0   -0.1</code></pre><h2 id="second-layer"><a class="docs-heading-anchor" href="#second-layer">second layer</a><a id="second-layer-1"></a><a class="docs-heading-anchor-permalink" href="#second-layer" title="Permalink"></a></h2><p>First we calculate a sparsity pattern:</p><pre><code class="language-julia hljs">M_id = sparsity_pattern(M, 0.6, 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 SparseArrays.SparseMatrixCSC{Int64, Int64} with 13 stored entries:
 1  1  ⋅  1  ⋅
 1  ⋅  1  1  ⋅
 ⋅  1  1  ⋅  1
 1  1  ⋅  1  ⋅
 ⋅  ⋅  1  ⋅  ⋅</code></pre><p>For every column and every row of the Matrix the function solves the optimization problem</p><p class="math-container">\[max_{Z}\, ||x - x\circ Z(x)||_{0}\,\, s.t. \\\]</p><p class="math-container">\[\begin{align*}
(Z(x))_{i} &amp;= 0 \, \text{or}\, 1 \\
||Z(x)||_{0} &amp;\ge N \\
||x - x\circ Z(x)||_{p} 	\,&amp;\le\,  (1-q)||x||_{p},
\end{align*}\]</p><p>where <span>$Z$</span> is the sparsity pattern for the column or row. <span>$N$</span> is a maximum number for non zero entries, <span>$q$</span> is a factor that controls how sparse the the row or column should be. All the individual row and column patter are overlayed, if either row or column or both return a one for an entry the entry is one. This ensures that the pattern will preserve different Subspaces of the Matrix.</p><h2 id="second-layer-2"><a class="docs-heading-anchor" href="#second-layer-2">second layer</a><a class="docs-heading-anchor-permalink" href="#second-layer-2" title="Permalink"></a></h2><p>Than we can take the sparsity pattern and modify it to a binning pattern:</p><pre><code class="language-julia hljs">bin_sparse_matrix!(M, M_id, 200)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 SparseArrays.SparseMatrixCSC{Int64, Int64} with 13 stored entries:
 1  1  ⋅  2  ⋅
 1  ⋅  3  2  ⋅
 ⋅  3  4  ⋅  1
 2  2  ⋅  4  ⋅
 ⋅  ⋅  1  ⋅  ⋅</code></pre><p>The function looks at the maximum and minimum values of the matrix and then finds a partition of the negative and positive area according to the specified maximum number of bins. For each entry of the matrix it is checked to which bin it belongs to. The binning controls the number of unknowns and so the computation cost to solve the optimization problem. It also typically improves the conditioning of the optimization problem.</p><p>With the binning pattern we can find the Matrix so that the norm of the difference is as small as possible and so that the binning constrains are fullfilled:</p><pre><code class="language-julia hljs">binned_minimization(M_id, zeros(5, 5), Matrix{Float64}(I, 5, 5), M)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 SparseArrays.SparseMatrixCSC{Float64, Int64} with 13 stored entries:
 17.002  17.002     ⋅       6.945    ⋅ 
 17.002    ⋅       7.1      6.945    ⋅ 
   ⋅      7.1    -11.985     ⋅     17.002
  6.945   6.945     ⋅     -11.985    ⋅ 
   ⋅       ⋅      17.002     ⋅       ⋅ </code></pre><p>The function solves the optimization problem</p><p class="math-container">\[min ||M - X||_{F} \,\, s.t.\]</p><p class="math-container">\[X\, \text{has the specified sparsity pattern}\, B(M) = M_{id}\]</p><p>Of course our example optimization problem is not too interesting, because without the binning only some entries are set to zero, while the others remain the same. However, more sophisticated optimization problems can be used here.</p><p>We can also use the sparsify function on <span>$M$</span>:</p><pre><code class="language-julia hljs">sparsify(M, 0.6, 2, 200)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 SparseArrays.SparseMatrixCSC{Float64, Int64} with 13 stored entries:
 13.7521   13.7521      ⋅         5.85139    ⋅ 
 13.7521     ⋅         5.24934    5.85139    ⋅ 
   ⋅        5.24934  -10.7842      ⋅       13.7521
  5.85139   5.85139     ⋅       -10.7842     ⋅ 
   ⋅         ⋅        13.7521      ⋅         ⋅ </code></pre><p>This function calculates the sparsity and binning pattern like we did and uses as optimization problem</p><p class="math-container">\[min\, \frac{1}{2} \sum\limits_{i=1}^r \frac{1}{\sigma_i^2} ||\left( X - M\right) v_i||_2^2
+ \frac{1}{2} \sum\limits_{i=1}^r \frac{1}{\sigma_i^2} ||\left( X^* - M^*\right) u_i||_2^2,\]</p><p>where r is the rank, <span>$\sigma_i$</span> are the r biggest singular values, <span>$v_i$</span> the corresponding right singular vectors and <span>$u_i$</span> the corresponding left singular vectors of M. <span>$M^*$</span> denotes the conjugate transpose of <span>$M$</span>. The function compares the action of the unknown matrix <span>$X$</span> with the action of M on the singular vectors of <span>$M$</span> and penalizes the differences in near null-space with larger weights. It can be formulatet in the form</p><p class="math-container">\[X M^+(M^+)^* + (M^+)^*M^+X = MM^+(M^+)^* (M^+)^*M^+M,\]</p><p>where <span>$M^+$</span> is the pseudo inverse of <span>$M$</span>. We can also set <code>impose_null_spaces</code> true:</p><pre><code class="language-julia hljs">sparsify(M, 0.6, 2, 200, true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 SparseArrays.SparseMatrixCSC{Float64, Int64} with 13 stored entries:
 13.7521   13.7521      ⋅         5.85139    ⋅ 
 13.7521     ⋅         5.24934    5.85139    ⋅ 
   ⋅        5.24934  -10.7842      ⋅       13.7521
  5.85139   5.85139     ⋅       -10.7842     ⋅ 
   ⋅         ⋅        13.7521      ⋅         ⋅ </code></pre><p>Then after the described optimization problem was solved the function also solves an additional optimization problem that ensures that the left and right null-spaces are preserved exactly. Because our matrix has full rank this makes no difference in our case.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Friday 25 March 2022 15:44">Friday 25 March 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
